# Intro 
Antes de comenzar. Estos son algunos conocimientos b√°sicos que necesitamos.

## Conocimientos b√°sicos del Pentesting
Esta es una lista que te permitir√° entender aquellas competencias y habilidades que necesitas para comenzar.

- Conocimiento en redes inform√°ticas üåê: Entender el modelo OSI para comprender los modelos de ataque que se llevan a cabo en las diferentes capas.

- Conocimiento en programaci√≥nüíª: Para las pruebas de tester es necesario tener conocimientos de programaci√≥n.
   Cuando se realice una prueba **White box testing o Black box texting** se pueda ver qu√© par√°metros reciben y determinar qu√© vulnerabilidades puede tener el sistema.
  - - **White box testing:** pruebas de seguridad cuando se tiene acceso al c√≥digo fuente o los binarios y proporciona informaci√≥n sobre los errores y las posibles vulnerabilidades.
  - - **Black box texting:** pruebas a aplicaciones sin tener el c√≥digo fuente ni la l√≥gica. Consisten en probar una aplicaci√≥n desde la perspectiva del usuario sin conocer su implementaci√≥n.

-  Conocimientos b√°sicos de bases de datos üë©‚Äçüíª: Entender c√≥mo los datos se relacionan entre s√≠ y c√≥mo se realizan las consultas a la base de datos, hay ataques que dependen de esto.

- Conocimiento en el funcionamiento b√°sico de los navegadores y aplicaciones üîé: C√≥mo funciona una aplicaci√≥n web y el env√≠o de datos a los navegadores. Se puede utilizar herramientas que permiten manipular las solicitudes por medio del http.

# [1] - CVE, Microsoft Vuln Database

Existen registros de vulnerabilidades en bases de datos como CVE o Microsoft Vuln Database. Estas permiten identificar de manera √∫nica cualquier vulnerabilidad y buscar informaci√≥n sobre ella en dichas bases de datos.

## ¬øQu√© es CVE y exploit?
Un CVE expone las fallas de seguridad que se encuentran disponibles al p√∫blico y el exploit es el software o c√≥digo malicioso que explota una vulnerabilidad de manera autom√°tica.

Las entradas de CVE son breves y no incluyen datos t√©cnicos ni informaci√≥n sobre los riesgos, el impacto o las soluciones.

MITRE Corporation es una organizaci√≥n que cuenta con partners que permite a los pentester registrar nuevas vulnerabilidades que se han encontrado.

## N√∫mero de identificaci√≥n de un CVE
La siguiente imagen muestra el n√∫mero de identificaci√≥n de un CVE:

![Estructura de un CVE](CiberSeguridad/imgs_ciber/CVE_STRUCTURE.webp)

Algunos sitios de vulnerabilidades
- [CVE](https://www.cve.org/)
- [MS Vulnerabilities](https://msrc.microsoft.com/update-guide/vulnerability)
- [MS 2017 Vulnerabilities](https://learn.microsoft.com/en-us/security-updates/securitybulletins/2017/securitybulletins2017)
- [National Vulnerability Database](https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator)
- [Common Weakness Enumeration](https://cwe.mitre.org/index.html)
- [Common Attack Enumeration and Classification](https://capec.mitre.org/)

## ¬øQu√© es eternal Blue?
Eternal Blue es una aplicaci√≥n gratuita que con un solo clic, nos permite comprobar si nuestro ordenador o cualquier otro conectado a la red local es vulnerable ante EternalBlue y podemos caer v√≠ctimas de los piratas inform√°tico.

Nos dir√° si nuestros ordenadores est√°n protegidos y no hay peligro de infectados con estas vulnerabilidades.

## Otras herramientas

- [Virus Total](https://www.virustotal.com/gui/home/upload): Sirve para verificar la reputaci√≥n de sitios o archivos

- [ExpandURL](https://www.expandurl.net/): Sirva para expandir URL acortadas y ver cual es el realmente el sitio de destino sin tener que ingresar a el

- [Kaspersky Pass Check](https://password.kaspersky.com/es/): Verificar qeu tan segura es una contrase√±a

- [Have i been pwned?](https://haveibeenpwned.com/): Sirve para verificar si tus correos o cuentas se han visto afectadas en filtraciones de informaci√≥n de empresas a nivel mundial.

- [PhishTank](https://phishtank.org/) : Sirve para ver si un sitio es real o es phishing

- [TALOS - Cisco](https://talosintelligence.com/): Sirve para ver la reputaci√≥n de la reputaci√≥n de sitios y otras cosas mas :v

- [OSINT Framework](https://osintframework.com/): Sirve apra obetener inteligencia de plataformas publicas. . Laboratorios de practica: TryHackMe OverTheWire HackTheBox .

# [2] - Enumeraci√≥n de vulnerabilidades comunes (CWE)

La enumeraci√≥n de vulnerabilidades comunes son un listado de vulnerabilidades que se encuentran en un software y son registrados por una entidad que las hace p√∫blica.

## ¬øCu√°l es la diferencia de un CWE Y CVE?
El objetivo del CWE es facilitar el uso eficaz de herramientas que puedan identificar, encontrar y resolver errores, vulnerabilidades y exposiciones en el software inform√°tico antes de que los programas se distribuyan o vendan p√∫blicamente.

### Cuadro de diferencias entre CWE Y CVE
| CWE (Common Weakness Enumeration)	| CVE (Common Vulnerability Exposure) |
| --- | --- |
|Es una entrada en la base de datos correspondiente a una debilidad y no est√° relacionado con un producto o sistema. | Es una entrada en la lista de vulnerabilidades, es decir, es una instancia espec√≠fica de una debilidad en un producto o sistema. |
| Se clasifican las vulnerabilidades por medio de c√≥digos: CWE-89	| Tiene un conjunto √∫nico que identifica a una vulnerabilidad: CVE-2017-0144 |

La enumeraci√≥n est√° enfocada en la recopilaci√≥n informaci√≥n que ayuda al Pentester o a los equipos de ciberseguridad a encontrar puntos d√©biles en el sistema. Es la primera tarea que deber√≠a hacer un Pentester.

## Algunos tipos de enumeraci√≥n a la hora de hacer Pentestingüîé
- DNS Enumeration
- NetBIOS Enumeration
- Windows Enumeration
- SNMP Enumeration
- NTP Enumeration

# [3] - Enumeraci√≥n y clasificaci√≥n de patrones de ataque comunes (CAPEC)

Los patrones de ataque engloban todas las t√©cnicas que sean utilizadas com√∫nmente, desde acceder f√≠sicamente a instalaciones con Lockpicking hasta t√©cnicas de Spoofing.

## ¬øQu√© es CAPEC?
[CAPEC](https://capec.mitre.org/) ayuda a proporcionar un diccionario completo de patrones conocidos de ataque empleados por los adversarios para explotar las debilidades conocidas en las capacidades habilitadas para el ciberespacio.

> Aunque puede parecer similar a CWE, no lo es. Ya que las vulnerabilidades afectan a tecnolog√≠as y los patrones de ataque pueden no depender de le tecnolog√≠a.

Puede ser utilizado por analistas, desarrolladores, evaluadores y educadores para avanzar en la comprensi√≥n de la comunidad y mejorar las defensas.

**Lista de mecanismos de ataques en CAPEC**

Existen muchos mecanismos de ataque, por ello aqu√≠ te dejamos un corta lista para empezar.

- Spoofing
- SQL injection
- Manipular el comportamiento humano

**Cuadro de diferencia de CWE Y CAPEC**

| CWE | CAPEC |
| --- | --- |
| Registra vulnerabilidades de software o hardware | La mayor√≠a de patrones de ataque no entran c√≥mo vulnerabilidad, como el spoofing (pasa por una entidad o dispositivo de confianza para conseguir beneficios para el ciberdelicuente) |

## ¬øQu√© es lockpicking?

El lockpicking es una disciplina que consiste en romper la seguridad de cerraduras manipulando sus componentes f√≠sicos, es decir, abrirlas sin la nececidad de la llave original.
Esto se puede utilizar para acceder a lugares que suelen estra protegidas con cerraduras y candados, lugares que un hacker requerir√≠a acceder para lograr alg√∫n ataque en especifico.

El Lockpicking si es considerado como un patr√≥n de ataque, lo puedes comprobar accediendo al sitio web de CAPEC con el codigo 393.

## NOTA
- CVE: Identificaci√≥n √∫nica de una vulnerabilidad
- CWE: A que tipo pertenece esta vulnerabilidad
- CAPEC: Cual es el patron de ataque que esta relacionado.

> Al hacer una auditoria y crear un reporte. En el reporte tenemos que indicar cu√°l es la vulnerabilidad de manera √∫nica con el registro CVE, a qu√© patron de ataque pertenece con CAPEC y a que tipo de vulnerabilidad pertenece con CWE. 

# [4] - Sistema de puntuaci√≥n de vulnerabilidades comunes [(CVSS)](https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator) 

El CVSS (Common Vulnerability Scoring System) define qu√© tan cr√≠tica es una vulnerabilidad.
## M√©tricas de puntuaci√≥n de vulnerabilidades

El siguiente cuadro muestra las m√©trica b√°sicas y de impacto de una vulnerabilidad.

| M√©trica de puntuaci√≥n b√°sica |	M√©tricas de impacto ‚Äì Tr√≠ada CIA
| --- | --- |
| Vector de ataque (Attack Vector - AV) |	Impacto en la confidencialidad (Confidentiality Impact - C) |
| Complejidad del ataque ( Attack Complexity - AC) | Impacto en la integridad (Integrity Impact - I) |
| Privilegios requeridos (Privileges Required - PR) | Impacto en la disponibilidad (Availability Impact - A) |

**Interacci√≥n con el usuario (User Interaction - UI)**

Si la vulnerabilidad afecta una aplicaci√≥n web es un ataque remoto.
Si requiere dentro de un ataque de un equipo de la red utilizando protocolo SMB, es un ataque de red.

## ¬øQu√© significa la puntuaci√≥n en vulnerabilidad?

Como el CVSS en realidad es una f√≥rmula. Es un sistema que tiene en cuenta diferentes aspectos para dar una valoraci√≥n de 0 a 10 a esa vulnerabilidad.

- Mientras m√°s cerca se encuentre del 10, m√°s peligro representa para los usuarios.
- Cuando la puntuaci√≥n es entre 0 y 3,9 se considera una vulnerabilidad de severidad baja.
- Cuando la cifra resultante se encuentra entre 4 y 6,9 estar√≠amos ante una de peligrosidad media.
- Mientras que de 7 a 10 son las m√°s peligrosas.

# [5] - Seguridad por oscuridad

Seguridad por oscuridad es un t√©rmino que viene a identificar aquellas medidas que se configuran para proteger un activo, confiando en que nadie va a buscar ah√≠.

> En palabras de Auguste Kerckhoffs:
> ‚Äúel dise√±o de un sistema no deber√≠a requerir el secreto, y el compromiso del sistema no deber√≠a incomodar a los corresponsales‚Äù.

## Principios de la seguridad por oscuridad

**Se basa en los principios de Kerckhoffs** que describe la seguridad en un sistema criptogr√°fico.

- Si el sistema no es te√≥ricamente irrompible, al menos debe serlo en la pr√°ctica.
- La efectividad del sistema no debe depender de que su dise√±o permanezca en secreto.
- La clave debe ser f√°cilmente memorizable de manera que no haya que recurrir a notas escritas.
- Los criptogramas deber√°n dar resultados alfanum√©ricos.
- El sistema debe ser operable por una √∫nica persona.
- El sistema debe ser f√°cil de utilizar.

## Cuadro de diferencias sobre c√≥mo clasificar vulnerabilidades
| CVE(Common Vulnerability Exposure) |	CWE (Common Weakness Enumeration) | CAPEC | CVS (Common Vulnerability Scoring) |
| --- | --- | --- | --- |
| Listas de vulnerabilidades con un √∫nico identificador | Registra vulnerabilidades de software o hardware, se clasifican por medio de c√≥digos | Son patrones de ataque que no dependen de una vulnerabilidad | Define qu√© tan cr√≠tica es una vulnerabilidad | 

> Seguridad por oscuuridad es tratar de proteger algo, solo ocultandolo. P. ej. Mi sistema con el que manejo empleados tiene que ser puesto en Internet. Para protegerlo lo ubico en el
> puerto n√∫mero 65000. Asumiendo que quien nos ataque no buscar√° en todos los puerto. Pero esto realmente no es del todo seguro. No lo utilices.

# [6] - Obtenci√≥n de Inteligencia

La obtenci√≥n de inteligencia se utiliza para descubrir y recopilar informaci√≥n para conocer el sistema de destino. Tambi√©n analiza la informaci√≥n para identificar rutas de ataques.

## Ciclo de vida del pentesting

## Objetivos
- La inteligencia se ocupa de obtener y analizar la informaci√≥n para identificar y predecir amenazas
- Llevar a cabo toma de decisiones de manera inteligente

### Subfases

- **Recoleci√≥n inteligente pasiva:**

**Obtener informaci√≥n de fuentes abiertas (OSINT - Open Source Intelligence)**.

> Pueden ser: noticieros, revistas cientificas o generales, art√≠culos, Internet, etc. Todo lo que es p√∫blico. 

- [Mapa OSINT](https://map.malfrats.industries/)
- [OPEN SOURCE INTELLIGENCE TOOLS AND RESOURCES HANDBOOK 2020](https://i-intelligence.eu/uploads/public-documents/OSINT_Handbook_2020.pdf) <- Libro

![Mapa de OSINT](imgs_ciber/OSINT.webp)

- **Recolecci√≥n inteligente semipasiva:**

Obtiene informaci√≥n p√∫blica. La diferencia con la forma pasiva es que aqu√≠ **se interact√∫a con los servidores** de las empresas que queremos recolectar informaci√≥n.
Ejemplo: conocer la estructura de una aplicaci√≥n web haciendo peticiones. La empresa sabe que nosotros hicimos las solicitudes y aunque es p√∫blica, se puede pensar que 
queremos hackear la empresa. 

- **Recolecci√≥n inteligente activa:**

Interactuar√° directamente con empleados de la organizaci√≥n, con el sistema inform√°tico de la organizaci√≥n. Enviaos peticiones o paquetes de manera intrsiva. 
Todo con la finalidad de obtener informaci√≥n.
Ejemplos: mapeo de red o puertos (nmap). Y esto, si no tenemos el permiso de la compa√±ia, puede ser considerado ilegal si no tenemos el permiso de la empresa. 

# [7] An√°lisis de vulnerabilidades (2da fase del ciclo de vida del pentesting)

> Identificar vulnerabilidades no es corregir fallos. Significa encontrar brechas que pueden exponer amenazas.

**Objetivos:**
- Identificar las deficiencias de seguridad en un sistema inform√°tico
- Definir el alcance probable de las amenazas
  

## Herramientas para identificar vulnerabilidades

Existen dos herramientas que te ser√°n muy √∫tiles. Ambas ayudan a identificar las vulnerabilidades y comprobar 
su ejecutividad en los sistemas, identificar y confirmar si es vulnerable. Permiten el alcance de la amenaza,
qu√© se puede saber y hasta d√≥nde un atacante puede llegar.

## Blind SQL Injection

Es un tipo de ataque de inyecci√≥n SQL que hace preguntas verdaderas o falsas a la base de datos y determina la respuesta bas√°ndose en
la respuesta de las aplicaciones.

## Website Crawling

Es la obtenci√≥n automatizada de p√°ginas web mediante un proceso de software, cuyo objetivo es indexar el contenido de los sitios web para que puedan ser buscados.
El rastreador analiza el contenido de una p√°gina en busca de enlaces a las siguientes p√°ginas para obtenerlas e indexarlas.

## Lista de esc√°neres disponibles

Aqu√≠ tienes una lista de esc√°neres para vulnerabilidades

**Para la web:**
- Acunetix
- **Netsparker**
- Vega
- Burpsuite Pro
- Wpscan (exclusivo para Wordpress)
- Joomscan ( exclusivo para Joomla)
- Wapiti
- W3af
- Nikto
- Modulos de Metasploit Framework
- [Vega (Subgraph)](https://subgraph.com/vega/) - Programa con GUI para analisar WEB seg√∫n OWASP TOP 10 con un reporte completo
**Redes:**

- OpenVAS que la version free/OpenSource de Nessus
- Nessus
- Nexpose
- Nmap (Scripting Engine)
- Modulos de Metasploit Framework
- OpenVAS (la version free/OpenSource de Nessus)

> Una buena cantidad de las herraientas mencionadas previamente ya vienen por defecto en Kali Linux

# [8] - T√©cnicas de ataque y explotaci√≥n de vulnerabilidades

## Objetivos: 
- Definir los vectores de ataque con base en la inteligencia recabada y a las vulnerabilidades identificadas
- Verificar la existencia y explotaci√≥n de las vulnerabilidades

 Algunos ejemplos de vectores de ataque incluyen:

- Atacar las vulnerabilidades encontradas
- Ataques miscel√°neos (aquellos que no entran en una categor√≠a)
- - P. ej. Ataques de denegaci√≥n de servicio, ataques de fuerza bruta
- Ingenier√≠a social
- Ataques de acceso f√≠sico

## ¬øQu√© es un exploit de d√≠a cero?

Un "d√≠a cero" o "0Day" en el √°mbito de la ciberseguridad es una vulnerabilidad en un dispositivo conectado a Internet, componente de red o pieza de software que acaba de ser descubierto o expuesto.
La idea es que esta vulnerabilidad no tiene historia previa, es decir, tiene cero d√≠as de existencia.

## ¬øPor qu√© son tan importante los 0 day?

Las vulnerabilidades de d√≠a cero son el tipo de vulnerabilidad m√°s dif√≠cil de proteger, ya que pocas empresas de seguridad y muy pocos paquetes de software antivirus (si es que hay alguno)
est√°n preparados para manejarlas o el malware que intenta explotarlas.

Cuando se descubre una vulnerabilidad de d√≠a cero, no hay parches disponibles para resolver el problema, y no hay otras estrategias de mitigaci√≥n porque todos se acaban de enterar de la vulnerabilidad.

> [Zerodium](https://zerodium.com/) es una empresa que compra exploits de d√≠a cero.  

# [9] - Post-explotaci√≥n

## Objetivos 
- Identificar vulnerabilidades locales
- Obtener privilegios de sistema
- Identificar el alcance probado de una amenaza
- Obtener informaci√≥n
- Escalar a otros sistemas

Prueba la existencia de una amenaza o permite obtener informaci√≥n de la organizaci√≥n y del sistema con el escalado de privilegios.
Tambi√©n identifica las vulnerabilidades locales y el alcance de la amenaza.

## ¬øQu√© es el escalamiento de privilegio?

La escalada de privilegios es la explotaci√≥n de una vulnerabilidad en un sistema operativo o aplicaci√≥n, ya sea en Windows, Linux o MacOs.
Esta vulnerabilidad puede ser un defecto de dise√±o o un descuido de configuraci√≥n, y permite obtener autorizaci√≥n a recursos que normalmente est√°n restringidos al usuario.

Este tipo de ataque es importante porque permite obtener niveles de administrador (root).

## ¬øQu√© puedo hacer al escalar privilegios?

- Resetear contrase√±as
- Eludir el control de acceso para comprometer los datos protegidos
- Editar la configuraci√≥n del software
- Puede acceder a la m√°quina de nuevo m√°s tarde
- Cambiar los privilegios de los usuarios

![Escalamiento Vertical De Privilegios](imgs_ciber/EscalamientoVertical.webp)


El **escalamiento vertical** se da cuando se tiene acceso a una cuenta existe que permita escalar hasta el root.

![Escalamiento Horizontal De Privilegios](imgs_ciber/EscalamientoHorizontal.webp)

El **escalamiento horizontal** toma el control de diferentes usuarios hasta llegar al root.
